/*! rcm-loading 2018-01-12 */

var rcmLoading={defaultConfig:{baseUrl:"/bower_components/rcm-loading/dist",templateFolder:"/template",template:"default",loadingMessage:"",loadingCompleteMessage:"",waitBeforeShow:1e3,waitBeforeHide:500},config:{},eventName:{start:"rcmLoading.start",change:"rcmLoading.change",complete:"rcmLoading.complete"},serviceInstance:null,getConfigValue:function(key,defaultValue){return void 0!==rcmLoading.config[key]?rcmLoading.config[key]:void 0!==defaultValue?defaultValue:void 0!==rcmLoading.defaultConfig[key]?rcmLoading.defaultConfig[key]:null},getTemplateUrl:function(file){file||(file="");var baseUrl=rcmLoading.getConfigValue("baseUrl"),template=rcmLoading.getConfigValue("template");return baseUrl+rcmLoading.getConfigValue("templateFolder")+"/"+template+"/"+file},getServiceInstance:function(config){return rcmLoading.serviceInstance?rcmLoading.serviceInstance:(rcmLoading.buildServiceInstance(config),rcmLoading.serviceInstance)},buildServiceInstance:function(config){config||(config=rcmLoading.defaultConfig),rcmLoading.serviceInstance=new rcmLoading.Service(config)},isLoading:function(name){return rcmLoading.getServiceInstance().tracker.isLoading(name)},setLoading:function(name,amount,options){rcmLoading.getServiceInstance().setLoading(name,amount,options)},onLoadingStart:function(method,id){rcmLoading.getServiceInstance().events.on(rcmLoading.eventName.start,method,id,!0)},onLoadingChange:function(method,id){rcmLoading.getServiceInstance().events.on(rcmLoading.eventName.change,method,id,!0)},onLoadingComplete:function(method,id){rcmLoading.getServiceInstance().events.on(rcmLoading.eventName.complete,method,id,!0)}},RcmLoadingLoader=function(rcmLoading,preShow,show,hide,setLoadingMessage){var self=this,waitBeforeShow=rcmLoading.getConfigValue("waitBeforeShow"),waitBeforeHide=rcmLoading.getConfigValue("waitBeforeHide"),showCount=0,showTimeout=null,hideTimeout=null,onLoadingStart=function(loadingParams){showCount++,preShow(),hideTimeout&&(window.clearTimeout(hideTimeout),hideTimeout=null),showTimeout||(showTimeout=window.setTimeout(show,waitBeforeShow))},onLoadingChange=function(loadingParams){var percentMsg="";loadingParams.tracker.getPercent()>0&&rcmLoading.getConfigValue("showPercent")&&(percentMsg=loadingParams.tracker.getPercent()+"%"),setLoadingMessage(rcmLoading.getConfigValue("loadingMessage"),percentMsg)},onLoadingComplete=function(loadingParams){--showCount>0||(showCount=0,showTimeout&&(window.clearTimeout(showTimeout),showTimeout=null),hideTimeout&&(window.clearTimeout(hideTimeout),hideTimeout=null),hideTimeout=window.setTimeout(hide,waitBeforeHide))};self.init=function(){rcmLoading.onLoadingStart(onLoadingStart,"rcmGlobalLoader"),rcmLoading.onLoadingChange(onLoadingChange,"rcmGlobalLoader"),rcmLoading.onLoadingComplete(onLoadingComplete,"rcmGlobalLoader")}};rcmLoading.Params=function(options){var self=this;self.name=null,self.amount=0,self.startMessage="",self.options=null,self.onChange=function(params){},self.onComplete=function(params){},self.init=function(options){self.setOptions(options)},self.setOptions=function(options){"string"==typeof options.name&&(self.name=options.name),"number"==typeof options.amount&&(self.amount=options.amount),"function"==typeof options.onChange&&(self.onChange=options.onChange),"function"==typeof options.onComplete&&(self.onComplete=options.onComplete),"string"==typeof options.startMessage&&(self.startMessage=options.startMessage),self.options=options},self.getPercent=function(){return null===self.amount?100:Math.round(100*self.amount)},self.isLoading=function(){return self.amount<1},self.init(options)},rcmLoading.Tracker=function(onLoadingStart,onLoadingChange,onLoadingComplete){var self=this;self.loadingAggregate={},self.loadingAmount=1,self.statusMessage="",self.getPercent=function(){return Math.round(100*self.loadingAmount)},self.getStatusMessage=function(){return self.statusMessage},self.isLoading=function(name){return name?self.getLoading(name)<1&&self.has(name):self.loadingAmount<1},self.setLoading=function(name,amount,options){amount=Number(amount);var hasLoading=self.has(name),currentAmount=null;hasLoading&&(currentAmount=self.loadingAggregate[name].amount),currentAmount!==amount&&(!hasLoading&&amount>=1||(hasLoading||self.add(name,amount,options),self.loadingAggregate[name].amount=amount,self.loadingAggregate[name].startMessage&&0===amount&&(self.statusMessage=self.loadingAggregate[name].startMessage),self.calc()))},self.getLoading=function(name){return self.has(name)?self.loadingAggregate[name].amount:null},self.has=function(name){return"object"==typeof self.loadingAggregate[name]},self.add=function(name,amount,options){options||(options={}),options.name=name,options.amount=amount;var params=new rcmLoading.Params(options);self.loadingAggregate[name]=params},self.remove=function(name){self.loadingAggregate[name]=void 0;try{delete self.loadingAggregate[name]}catch(exception){}},self.calc=function(){self.loadingAmount>=1&&self.onLoadingStart();var currentLoadingAmount=self.loadingAmount,currentLoading={},completeLoading={},total=0,count=0;for(var index in self.loadingAggregate)self.has(index)&&null!==self.loadingAggregate[index].amount&&(count++,total+=self.loadingAggregate[index].amount,currentLoading[index]=self.loadingAggregate[index],self.loadingAggregate[index].onChange(self.loadingAggregate[index]),self.loadingAggregate[index].amount>=1&&(completeLoading[index]=self.loadingAggregate[index],self.loadingAggregate[index].onComplete(self.loadingAggregate[index]),self.loadingAggregate[index].amount=null));self.loadingAmount=count>0?total/count:1,currentLoadingAmount!==self.loadingAmount&&self.onLoadingChange(currentLoading,completeLoading),self.loadingAmount>=1&&self.onLoadingComplete(completeLoading)},self.onLoadingStart=function(){"function"==typeof onLoadingStart&&onLoadingStart({tracker:self})},self.onLoadingChange=function(currentLoading,completeLoading){"function"==typeof onLoadingChange&&onLoadingChange({tracker:self,currentLoading:currentLoading,completeLoading:completeLoading})},self.onLoadingComplete=function(completeLoading){"function"==typeof onLoadingComplete&&onLoadingComplete({tracker:self,completeLoading:completeLoading}),self.statusMessage="",self.loadingAggregate={}}},rcmLoading.Service=function(){var self=this;self.tracker=null,self.events=new RcmEventManager;var onLoadingStart=function(loadingParams){self.events.trigger(rcmLoading.eventName.start,loadingParams)},onLoadingChange=function(loadingParams){self.events.trigger(rcmLoading.eventName.change,loadingParams)},onLoadingComplete=function(loadingParams){self.events.trigger(rcmLoading.eventName.complete,loadingParams)};self.init=function(){self.tracker=new rcmLoading.Tracker(onLoadingStart,onLoadingChange,onLoadingComplete)},self.setLoading=function(name,amount,options){self.tracker.setLoading(name,amount,options)},self.getTracker=function(){return self.tracker},self.init()};
//# sourceMappingURL=rcm-loading.min.js.map